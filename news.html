<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>News - The Colorado Now</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="main-header">
    <div class="logo-social-container">
      <div class="logo-container">
        <img src="logo.png" alt="The Colorado Now Logo" class="logo" />
      </div>
    </div>
    <nav class="main-nav">
      <a href="index.html">HOME</a>
      <a href="#">NEWS</a>
      <a href="life & culture.html">LIFE & CULTURE</a>
      <a href="opinion.html">OPINION</a>
      <a href="#">YOUTUBE</a>
      <a href="#">ABOUT US</a>
    </nav>
  </header>

  <main class="news-grid-container">
    <h1 class="news-heading">News</h1>
    <div class="news-grid">
      <div class="news-box" style="background-image: url('images/happening-now.jpg');">
        <a href="tag.html?tag=happening-now">Happening Now</a>
      </div>
      <div class="news-box" style="background-image: url('images/politics.jpg');">
        <a href="tag.html?tag=politics">Politics</a>
      </div>
      <div class="news-box" style="background-image: url('images/environment.jpg');">
        <a href="tag.html?tag=environment">Environment</a>
      </div>
      <div class="news-box" style="background-image: url('images/transportation.jpg');">
        <a href="tag.html?tag=transportation">Transportation</a>
      </div>
      <div class="news-box" style="background-image: url('images/education.jpg');">
        <a href="tag.html?tag=education">Education</a>
      </div>
    </div>
    <section class="articles" style="margin-top: 30px;">
  <h2 class="news-heading" style="text-align:left;">Latest in News</h2>
  <div id="news-latest-list" class="article-list"></div>
</section>
  </main>

  <!-- All Articles Button -->
  <div class="all-articles-cta">
    <a href="all-articles.html" class="btn-pill">View All Articles</a>
  </div>
<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://hnvcbrlyuytmawlpgaal.supabase.co';  /* <-- keep yours */
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhudmNicmx5dXl0bWF3bHBnYWFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NDI5NTYsImV4cCI6MjA3MTExODk1Nn0.Ik4LauJ_QOJGOo9ZOCbxmyldyqVtJy_PfCt-2rH4hLw'; /* <-- keep yours */
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script>
(async function () {
  const newsTags = ['happening-now','politics','environment','transportation','education'];
  const list = document.getElementById('news-latest-list');

  // 1) Load newest articles first
  const { data: rows, error } = await supabase
    .from('articles')
    .select('*')
    .order('timestamp', { ascending: false });

  if (error) {
    console.error('Error loading articles:', error);
    list.innerHTML = '<p>Could not load articles.</p>';
    return;
  }

  // 2) Filter to NEWS categories (works with tags[] or legacy tag)
  const filtered = (rows || []).filter(a => {
    if (Array.isArray(a.tags) && a.tags.length) {
      const lower = a.tags.map(t => String(t).toLowerCase());
      return newsTags.some(t => lower.includes(t));
    }
    if (Array.isArray(a.tag)) {
      const lower = a.tag.map(t => String(t).toLowerCase());
      return newsTags.some(t => lower.includes(t));
    }
    if (a.tag) {
      return newsTags.includes(String(a.tag).toLowerCase());
    }
    return false;
  });

  // 3) Render up to 8
  const toShow = filtered.slice(0, 8);

  function createCard(article) {
    const div = document.createElement('div');
    div.className = 'homepage-article-card';
    div.innerHTML = `
      <a href="article.html?id=${article.id}">
        ${article.image ? `<img src="${article.image}" alt="${article.title}" class="thumb" loading="lazy">` : ''}
        <h3>${article.title}</h3>
        <p>By ${article.author || ''}</p>
      </a>
    `;
    return div;
  }

  list.innerHTML = '';
  toShow.forEach(a => list.appendChild(createCard(a)));
})();
</script>
</body>
</html>
