<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Articles</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Georgia, serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th.sortable {
      cursor: pointer;
    }
    .actions button {
      margin-right: 5px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>Manage Published Articles</h1>
  <a href="admin.html">&#8592; Back to Admin</a>

  <table id="articlesTable">
    <thead>
      <tr>
        <th class="sortable" data-sort="title">Title</th>
        <th class="sortable" data-sort="author">Author</th>
        <th class="sortable" data-sort="tag">Tag</th>
        <th class="sortable" data-sort="date">Date</th>
        <th class="sortable" data-sort="views">Views</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

 <script>
  const tableBody = document.querySelector('#articlesTable tbody');
  let articles = JSON.parse(localStorage.getItem('articles') || '[]');
  let sortBy = 'date';
  let sortDir = 'desc';

  // Helper: turn tag (string or array) into a comparable string
  function tagToText(tag) {
    if (Array.isArray(tag)) return tag.join(', ');
    return tag || '';
  }
  function tagToKey(tag) {
    return tagToText(tag).toLowerCase();
  }

  function renderTable() {
    const sorted = [...articles].sort((a, b) => {
      if (sortBy === 'views') {
        return sortDir === 'asc' ? (a.views || 0) - (b.views || 0) : (b.views || 0) - (a.views || 0);
      } else if (sortBy === 'date') {
        return sortDir === 'asc'
          ? new Date(a.timestamp) - new Date(b.timestamp)
          : new Date(b.timestamp) - new Date(a.timestamp);
      } else if (sortBy === 'tag') {
        // Handles string or array
        return sortDir === 'asc'
          ? tagToKey(a.tag).localeCompare(tagToKey(b.tag))
          : tagToKey(b.tag).localeCompare(tagToKey(a.tag));
      } else {
        // title, author, etc.
        const aVal = (a[sortBy] || '').toLowerCase();
        const bVal = (b[sortBy] || '').toLowerCase();
        return sortDir === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
      }
    });

    tableBody.innerHTML = '';
    for (const article of sorted) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>
          <a href="article.html?id=${article.id}" style="color: inherit; text-decoration: none;">
            ${article.title}
          </a>
        </td>
        <td>${article.author || ''}</td>
        <td>${tagToText(article.tag)}</td>
        <td>${new Date(article.timestamp).toLocaleString()}</td>
        <td>${article.views || 0}</td>
        <td class="actions">
          <button onclick="deleteArticle(${article.id})">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    }
  }

  function deleteArticle(id) {
    if (!confirm("Are you sure you want to delete this article?")) return;
    articles = articles.filter(article => article.id !== id);
    localStorage.setItem('articles', JSON.stringify(articles));
    renderTable();
  }

  document.querySelectorAll('th.sortable').forEach(th => {
    th.addEventListener('click', () => {
      const newSortBy = th.dataset.sort;
      if (sortBy === newSortBy) {
        sortDir = sortDir === 'asc' ? 'desc' : 'asc';
      } else {
        sortBy = newSortBy;
        sortDir = 'asc';
      }
      renderTable();
    });
  });

  renderTable();
</script>
</body>
</html>

