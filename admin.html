<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Publish Article</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Georgia, serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, textarea, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      font-size: 16px;
    }
    .admin-nav {
      text-align: center;
      margin-bottom: 20px;
    }
    .admin-nav a {
      margin: 0 10px;
      text-decoration: none;
      color: #B5281A; /* brand red */
    }

    /* Tag groups */
    .tag-groups {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 10px;
    }
    .tag-group {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px;
    }
    .tag-group h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
    }
    .checkbox-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px 14px;
    }
    .checkbox-list label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
      font-weight: normal;
    }
    .inline-hint {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
      display: block;
    }
    button[type="submit"] {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="admin-nav">
    <a href="admin.html">New Article</a>
    <a href="admin-manage.html">Manage Articles</a>
  </div>

  <h1>Publish New Article</h1>

  <form id="articleForm">
    <label for="title">Article Title:</label>
    <input type="text" id="title" required>

    <label for="author">Author:</label>
    <input type="text" id="author" required>
    <label for="authorPhoto">Author Photo URL (optional):</label>
<input type="url" id="authorPhoto" placeholder="https://…">

<label for="authorBio">Author Bio (optional):</label>
<textarea id="authorBio" rows="4" placeholder="Short bio shown on the author page."></textarea>

    <label for="image">Image URL:</label>
    <input type="url" id="image" placeholder="https://…">

    <label for="body">Article Content:</label>
    <textarea id="body" rows="10" required></textarea>

    <label for="date">Publication Date (optional):</label>
    <input type="date" id="date">

    <label>Tags (choose one or more):</label>
    <div class="tag-groups">
      <div class="tag-group">
        <h3>News</h3>
        <div class="checkbox-list">
          <label><input type="checkbox" name="tags" value="happening-now"> Happening Now</label>
          <label><input type="checkbox" name="tags" value="politics"> Politics</label>
          <label><input type="checkbox" name="tags" value="environment"> Environment</label>
          <label><input type="checkbox" name="tags" value="transportation"> Transportation</label>
          <label><input type="checkbox" name="tags" value="education"> Education</label>
        </div>
      </div>

      <div class="tag-group">
        <h3>Life & Culture</h3>
        <div class="checkbox-list">
          <label><input type="checkbox" name="tags" value="people"> People</label>
          <label><input type="checkbox" name="tags" value="events"> Events</label>
          <label><input type="checkbox" name="tags" value="reviews"> Reviews</label>
        </div>
      </div>

      <div class="tag-group">
        <h3>Opinion</h3>
        <div class="checkbox-list">
          <label><input type="checkbox" name="tags" value="opinion"> Opinion</label>
        </div>
        <span class="inline-hint">You can combine “Opinion” with other tags if appropriate.</span>
      </div>
    </div>

    <label>
      <input type="checkbox" id="editorsPick">
      Feature in Editor's Picks
    </label>

    <button type="submit">Publish Article</button>
  </form>

  <script>
    function slugifyName(name) {
    return (name || '')
      .toLowerCase()
      .trim()
      .replace(/\s+/g, '-')
      .replace(/[^a-z0-9\-]/g, '');
  } 
    
    document.getElementById('articleForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Collect selected tags (array)
      const tagChecks = Array.from(document.querySelectorAll('input[name="tags"]:checked'));
      const selectedTags = tagChecks.map(cb => cb.value);

      if (selectedTags.length === 0) {
        alert("Please select at least one tag.");
        return;
      }

      const customDate = document.getElementById('date').value;
      // Gather author info
const authorName = document.getElementById('author').value;
const authorSlug = slugifyName(authorName);
const authorPhoto = document.getElementById('authorPhoto').value;
const authorBio = document.getElementById('authorBio').value;

// Upsert authors registry in localStorage
const authors = JSON.parse(localStorage.getItem('authors') || '{}');
authors[authorSlug] = {
  name: authorName,
  photo: authorPhoto || (authors[authorSlug]?.photo || ''),
  bio: authorBio || (authors[authorSlug]?.bio || '')
};
localStorage.setItem('authors', JSON.stringify(authors));

      const newArticle = {
  id: Date.now(),
  title: document.getElementById('title').value,
  author: document.getElementById('author').value,
  authorSlug: authorSlug,  // <-- added
  image: document.getElementById('image').value,
  body: document.getElementById('body').value,
  tag: selectedTags, // if your file still has single-select, this might be selectedTag
  timestamp: customDate ? new Date(customDate).toISOString() : new Date().toISOString(),
  views: 0,
  editorsPick: document.getElementById('editorsPick').checked
};

      const articles = JSON.parse(localStorage.getItem('articles') || '[]');
      // Put newest first
      articles.unshift(newArticle);
      localStorage.setItem('articles', JSON.stringify(articles));

      alert("Article published!");
      this.reset();
    });
  </script>
</body>
</html>
